<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="kr.co.vida.img">
  	<select id="getGoodsImgs" parameterType="int" resultType="imgDto" >
  		SELECT img_no, goods_no, img_name, img_status
  		FROM image
  		WHERE goods_no = #{goods_no}
  		ORDER BY img_status asc
  	</select>
  	<select id="readAll" parameterType="se" resultType="imgDto">
  	SELECT i.img_no, i.goods_no, i.img_name, i.img_status, g.qty,
  				g.goods_name, g.goods_price, g.discount_rate, 
  				g.stock, g.package_type, g.origin, g.goods_info, 
  				g.sub_cat_code, g.project_status, g.sales_amt
	FROM (SELECT ROWNUM rn, i.img_no, i.goods_no, i.img_name, i.img_status, g.qty,
			  				g.goods_name, g.goods_price, g.discount_rate, 
			  				g.stock, g.package_type, g.origin, g.goods_info, 
			  				g.sub_cat_code, g.project_status, g.sales_amt
			FROM (SELECT i.img_no, i.goods_no, i.img_name, i.img_status, g.qty,
			  				g.goods_name, g.goods_price, g.discount_rate, 
			  				g.stock, g.package_type, g.origin, g.goods_info, 
			  				g.sub_cat_code, g.project_status, g.sales_amt
		  		FROM image i, goods g, sub_category s
		  		WHERE i.goods_no = g.goods_no
		  		AND g.sub_cat_code = s.sub_cat_code
		  		AND i.img_status = 0
		  		AND s.main_cat_code = #{main_cat_code})
			WHERE ROWNUM &lt;=#{endNo})
	WHERE rn &gt;=#{startNo}
  	</select>
  	<select id="getMainImg" resultType="imgDto" parameterType="int" >
  		SELECT i.img_no, i.goods_no, i.img_name, i.img_status, g.qty,
  				g.goods_name, g.goods_price, g.discount_rate, 
  				g.stock, g.package_type, g.origin, g.goods_info, 
  				g.sub_cat_code, g.project_status, g.sales_amt
  		FROM image i, goods g, sub_category s
  		WHERE i.goods_no = g.goods_no
  		AND g.sub_cat_code = s.sub_cat_code
  		AND i.img_status = 0
  		AND s.main_cat_code = #{main_cat_code}
<!--    		<if test="orderbyType != null and orderbyType =='date'">
  			ORDER BY add_data desc
  		</if>
  		<if test="orderbyType != null and orderbyType =='hi_price'">
  			ORDER BY g.goods_price-(g.discount_rate/100*g.goods_price) desc
  		</if>
  		<if test="orderbyType != null and orderbyType =='low_price'">
  			ORDER BY g.goods_price-(g.discount_rate/100*g.goods_price) asc
  		</if>
  		<if test="orderbyType != null and orderbyType =='review'">
  			ORDER BY goods_no asc
  		</if>
  		<if test="orderbyType != null and orderbyType =='sales'">
  			ORDER BY g.sales_amt desc
  		</if>  -->
  	
  	</select>
  	<select id="getTotalbyMainCode" resultType="int" parameterType="int">
  		SELECT count(*)
		FROM (SELECT i.img_no, i.goods_no, i.img_name, i.img_status, g.qty,
  				g.goods_name, g.goods_price, g.discount_rate, 
  				g.stock, g.package_type, g.origin, g.goods_info, 
  				g.sub_cat_code, g.project_status, g.sales_amt
  			FROM image i, goods g, sub_category s
  			WHERE i.goods_no = g.goods_no
  			AND g.sub_cat_code = s.sub_cat_code
  			AND i.img_status = 0
  			AND s.main_cat_code = #{main_cat_code})
  	</select>
  	<select id="getMainImgBySubCode" parameterType="int" resultType="imgDto" >
  		SELECT i.img_no, i.goods_no, i.img_name, i.img_status, g.qty,
  				g.goods_name, g.goods_price, g.discount_rate, 
  				g.stock, g.package_type, g.origin, g.goods_info, 
  				g.sub_cat_code, g.project_status
  		FROM image i, goods g 
  		WHERE i.goods_no = g.goods_no
		AND i.img_status=0 
		AND i.goods_no IN (SELECT g.goods_no 
						FROM goods g
						WHERE sub_cat_code = #{g.sub_cat_code, jdbcType=VARCHAR})
  	</select>
  	<select id="getTotalbySubCode" resultType="int" parameterType="int">
  	SELECT count(*)
	FROM (SELECT i.img_no, i.goods_no, i.img_name, i.img_status, g.qty,
  				g.goods_name, g.goods_price, g.discount_rate, 
  				g.stock, g.package_type, g.origin, g.goods_info, 
  				g.sub_cat_code, g.project_status
  			FROM image i, goods g 
  			WHERE i.goods_no = g.goods_no
			AND i.img_status=0 
			AND i.goods_no IN (SELECT g.goods_no 
						FROM goods g
						WHERE sub_cat_code = #{g.sub_cat_code, jdbcType=VARCHAR}))
  	</select>
  	<insert id="insertImgOne" parameterType="imgDto">
  		INSERT INTO image VALUES (img_no_seq.nextval , #{goods_no} , #{img_name} , #{img_status} )
  	</insert>
  	
  	<select id="getMainImgOne" parameterType="int" resultType="imgDto">
  		SELECT img_name
  		FROM image
  		WHERE goods_no = #{goods_no}
  		AND img_status = 1
  	</select>
  	<delete id="deleteOne" parameterType="int">
  		DELETE image
  		WHERE img_no = #{img_no}
  	</delete>
  	
  </mapper>